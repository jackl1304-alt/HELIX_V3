import{ar as me,r as p,a as $,b as C,j as e,B as o,aJ as he,_ as m,C as B,c as S,d as z,q as T,e as k,U as Z,h as L,E as xe,ax as ue,k as je,aw as pe,aI as D,az as I,O as ge,I as ve}from"./index-DALcbLRd.js";import{S as E,a as U,b as F,c as R,d as i}from"./select-ChbPGzYm.js";import{D as _,a as fe,b as W,c as G,d as J,e as X}from"./dialog-CFphmdUB.js";import{u as Ne,a as be,F as Y,b as n,c as t,d as l,e as c,f as d,o as we,j as ye,h as Ae,i as Ce,s as v}from"./types-B9wljmK5.js";import{S as ee}from"./switch-C_RqhjZb.js";import{T as Be,a as Se,b as M,c as V}from"./tabs-BODnktcJ.js";import{T as ze,a as Te,b as se,c as x,d as ke,e as u}from"./table-JIUKJ_dM.js";import"./index-CyC2EL48.js";const Le=we({email:v().email("Ungültige E-Mail-Adresse"),firstName:v().min(1,"Vorname erforderlich"),lastName:v().min(1,"Nachname erforderlich"),role:Ce(["admin","reviewer","user"]),isActive:Ae(),permissions:ye(v()).optional()}),De=[{id:"1",email:"admin@helix.com",firstName:"Max",lastName:"Mustermann",role:"admin",isActive:!0,lastLoginAt:"2025-01-27T10:30:00Z",createdAt:"2024-12-01T09:00:00Z",permissions:["read","write","delete","admin","user_management"],profileImageUrl:"https://api.dicebear.com/7.x/avataaars/svg?seed=admin"},{id:"2",email:"reviewer@helix.com",firstName:"Anna",lastName:"Schmidt",role:"reviewer",isActive:!0,lastLoginAt:"2025-01-27T08:15:00Z",createdAt:"2024-12-15T14:30:00Z",permissions:["read","write","approve"],profileImageUrl:"https://api.dicebear.com/7.x/avataaars/svg?seed=reviewer"},{id:"3",email:"user@helix.com",firstName:"Thomas",lastName:"Weber",role:"user",isActive:!0,lastLoginAt:"2025-01-26T16:45:00Z",createdAt:"2025-01-10T11:20:00Z",permissions:["read"],profileImageUrl:"https://api.dicebear.com/7.x/avataaars/svg?seed=user"},{id:"4",email:"inactive@helix.com",firstName:"Maria",lastName:"Klein",role:"user",isActive:!1,createdAt:"2024-11-20T12:00:00Z",permissions:["read"]}],Ie=[{id:"1",userId:"1",action:"User Login",details:"Successful login via SSO",timestamp:"2025-01-27T10:30:00Z",ipAddress:"192.168.1.100"},{id:"2",userId:"2",action:"Approval Action",details:"Approved newsletter 'Weekly MedTech Update'",timestamp:"2025-01-27T08:15:00Z",ipAddress:"192.168.1.101"},{id:"3",userId:"1",action:"User Created",details:"Created new user account for thomas.weber@helix.com",timestamp:"2025-01-26T14:20:00Z",ipAddress:"192.168.1.100"}],Ee={admin:"bg-red-100 text-red-800 border-red-200",reviewer:"bg-blue-100 text-blue-800 border-blue-200",user:"bg-green-100 text-green-800 border-green-200"},Ue={admin:ve,reviewer:ge,user:Z},Fe=[{id:"read",label:"Lesen",description:"Daten anzeigen und lesen"},{id:"write",label:"Schreiben",description:"Daten erstellen und bearbeiten"},{id:"delete",label:"Löschen",description:"Daten löschen"},{id:"approve",label:"Genehmigen",description:"Inhalte genehmigen oder ablehnen"},{id:"admin",label:"Administration",description:"Vollzugriff auf alle Funktionen"},{id:"user_management",label:"Benutzerverwaltung",description:"Benutzer verwalten"}];function $e(){const{toast:h}=me(),[O,P]=p.useState(null),[re,f]=p.useState(!1),[ae,g]=p.useState(!1),[j,ie]=p.useState(""),[N,ne]=p.useState("all"),r=Ne({resolver:be(Le),defaultValues:{email:"",firstName:"",lastName:"",role:"user",isActive:!0,permissions:["read"]}}),{data:q=De,isLoading:Re}=$({queryKey:["/api/users"],enabled:!1}),{data:te=Ie,isLoading:Me}=$({queryKey:["/api/users/activity"],enabled:!1}),b=C({mutationFn:async s=>await I("/api/users","POST",s),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/users"]}),f(!1),r.reset(),h({title:"Benutzer erstellt",description:"Der neue Benutzer wurde erfolgreich erstellt."})},onError:()=>{h({title:"Fehler",description:"Benutzer konnte nicht erstellt werden.",variant:"destructive"})}}),w=C({mutationFn:async({id:s,...a})=>await I(`/api/users/${s}`,"PATCH",a),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/users"]}),g(!1),P(null),r.reset(),h({title:"Benutzer aktualisiert",description:"Die Benutzerdaten wurden erfolgreich aktualisiert."})},onError:()=>{h({title:"Fehler",description:"Benutzer konnte nicht aktualisiert werden.",variant:"destructive"})}}),le=C({mutationFn:async s=>await I(`/api/users/${s}`,"DELETE"),onSuccess:()=>{D.invalidateQueries({queryKey:["/api/users"]}),h({title:"Benutzer gelöscht",description:"Der Benutzer wurde erfolgreich gelöscht."})},onError:()=>{h({title:"Fehler",description:"Benutzer konnte nicht gelöscht werden.",variant:"destructive"})}}),ce=q.filter(s=>{var Q,H;const a=j===""||s.email.toLowerCase().includes(j.toLowerCase())||((Q=s.firstName)==null?void 0:Q.toLowerCase().includes(j.toLowerCase()))||((H=s.lastName)==null?void 0:H.toLowerCase().includes(j.toLowerCase())),A=N==="all"||s.role===N;return a&&A}),y=s=>new Date(s).toLocaleDateString("de-DE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),de=s=>{P(s),r.reset({email:s.email,firstName:s.firstName||"",lastName:s.lastName||"",role:s.role,isActive:s.isActive,permissions:s.permissions}),g(!0)},K=s=>{O?w.mutate({...s,id:O.id}):b.mutate(s)},oe=s=>{const a=Ue[s]||Z;return e.jsx(a,{className:"h-4 w-4"})};return e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Benutzerverwaltung"}),e.jsx("p",{className:"text-muted-foreground",children:"Verwalten Sie Benutzer, Rollen und Berechtigungen"})]}),e.jsxs(_,{open:re,onOpenChange:f,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Neuer Benutzer"]})}),e.jsxs(W,{className:"max-w-2xl",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Neuen Benutzer erstellen"}),e.jsx(X,{children:"Erstellen Sie ein neues Benutzerkonto mit entsprechenden Berechtigungen."})]}),e.jsx(Y,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(K),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:r.control,name:"firstName",render:({field:s})=>e.jsxs(t,{children:[e.jsx(l,{children:"Vorname"}),e.jsx(c,{children:e.jsx(m,{...s})}),e.jsx(d,{})]})}),e.jsx(n,{control:r.control,name:"lastName",render:({field:s})=>e.jsxs(t,{children:[e.jsx(l,{children:"Nachname"}),e.jsx(c,{children:e.jsx(m,{...s})}),e.jsx(d,{})]})})]}),e.jsx(n,{control:r.control,name:"email",render:({field:s})=>e.jsxs(t,{children:[e.jsx(l,{children:"E-Mail"}),e.jsx(c,{children:e.jsx(m,{type:"email",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:r.control,name:"role",render:({field:s})=>e.jsxs(t,{children:[e.jsx(l,{children:"Rolle"}),e.jsxs(E,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(c,{children:e.jsx(U,{children:e.jsx(F,{})})}),e.jsxs(R,{children:[e.jsx(i,{value:"user",children:"Benutzer"}),e.jsx(i,{value:"reviewer",children:"Reviewer"}),e.jsx(i,{value:"admin",children:"Administrator"})]})]}),e.jsx(d,{})]})}),e.jsx(n,{control:r.control,name:"isActive",render:({field:s})=>e.jsxs(t,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"text-base",children:"Aktiv"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Benutzer kann sich anmelden"})]}),e.jsx(c,{children:e.jsx(ee,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>f(!1),children:"Abbrechen"}),e.jsx(o,{type:"submit",disabled:b.isPending,children:b.isPending?"Erstelle...":"Erstellen"})]})]})})]})]})]}),e.jsxs(Be,{defaultValue:"users",className:"space-y-6",children:[e.jsxs(Se,{children:[e.jsx(M,{value:"users",children:"Benutzer"}),e.jsx(M,{value:"activity",children:"Aktivitäten"}),e.jsx(M,{value:"permissions",children:"Berechtigungen"})]}),e.jsx(V,{value:"users",children:e.jsxs(B,{children:[e.jsxs(S,{children:[e.jsx(z,{children:"Alle Benutzer"}),e.jsx(T,{children:"Übersicht über alle registrierten Benutzer im System"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(m,{placeholder:"Benutzer suchen...",value:j,onChange:s=>ie(s.target.value),className:"max-w-sm"}),e.jsxs(E,{value:N,onValueChange:ne,children:[e.jsx(U,{className:"w-40",children:e.jsx(F,{})}),e.jsxs(R,{children:[e.jsx(i,{value:"all",children:"Alle Rollen"}),e.jsx(i,{value:"admin",children:"Administrator"}),e.jsx(i,{value:"reviewer",children:"Reviewer"}),e.jsx(i,{value:"user",children:"Benutzer"})]})]})]})]}),e.jsx(k,{children:e.jsxs(ze,{children:[e.jsx(Te,{children:e.jsxs(se,{children:[e.jsx(x,{children:"Benutzer"}),e.jsx(x,{children:"Rolle"}),e.jsx(x,{children:"Status"}),e.jsx(x,{children:"Letzter Login"}),e.jsx(x,{children:"Erstellt"}),e.jsx(x,{className:"text-right",children:"Aktionen"})]})}),e.jsx(ke,{children:ce.map(s=>e.jsxs(se,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-muted flex items-center justify-center",children:s.profileImageUrl?e.jsx("img",{src:s.profileImageUrl,alt:`${s.firstName} ${s.lastName}`,className:"w-8 h-8 rounded-full"}):e.jsx(Z,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]})]})}),e.jsx(u,{children:e.jsxs(L,{className:Ee[s.role],variant:"outline",children:[oe(s.role),e.jsx("span",{className:"ml-1 capitalize",children:s.role})]})}),e.jsx(u,{children:e.jsx(L,{variant:s.isActive?"default":"secondary",children:s.isActive?"Aktiv":"Inaktiv"})}),e.jsx(u,{children:s.lastLoginAt?y(s.lastLoginAt):"Nie"}),e.jsx(u,{children:y(s.createdAt)}),e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>de(s),children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>le.mutate(s.id),disabled:s.role==="admin",children:e.jsx(ue,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})}),e.jsx(V,{value:"activity",children:e.jsxs(B,{children:[e.jsxs(S,{children:[e.jsx(z,{children:"Benutzeraktivitäten"}),e.jsx(T,{children:"Letzte Aktivitäten und Aktionen der Benutzer"})]}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:te.map(s=>{const a=q.find(A=>A.id===s.userId);return e.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center",children:e.jsx(je,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.action}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.details}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{children:["Benutzer: ",a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:y(s.timestamp)}),s.ipAddress&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:["IP: ",s.ipAddress]})]})]})]})]},s.id)})})})]})}),e.jsx(V,{value:"permissions",children:e.jsxs(B,{children:[e.jsxs(S,{children:[e.jsx(z,{children:"Berechtigungen verwalten"}),e.jsx(T,{children:"Übersicht über verfügbare Berechtigungen im System"})]}),e.jsx(k,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:Fe.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium",children:s.label}),e.jsxs(L,{variant:"outline",children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),s.id]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]},s.id))})})]})})]}),e.jsx(_,{open:ae,onOpenChange:g,children:e.jsxs(W,{className:"max-w-2xl",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Benutzer bearbeiten"}),e.jsx(X,{children:"Bearbeiten Sie die Benutzerdaten und Berechtigungen."})]}),e.jsx(Y,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(K),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:r.control,name:"firstName",render:({field:s})=>e.jsxs(t,{children:[e.jsx(l,{children:"Vorname"}),e.jsx(c,{children:e.jsx(m,{...s})}),e.jsx(d,{})]})}),e.jsx(n,{control:r.control,name:"lastName",render:({field:s})=>e.jsxs(t,{children:[e.jsx(l,{children:"Nachname"}),e.jsx(c,{children:e.jsx(m,{...s})}),e.jsx(d,{})]})})]}),e.jsx(n,{control:r.control,name:"email",render:({field:s})=>e.jsxs(t,{children:[e.jsx(l,{children:"E-Mail"}),e.jsx(c,{children:e.jsx(m,{type:"email",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:r.control,name:"role",render:({field:s})=>e.jsxs(t,{children:[e.jsx(l,{children:"Rolle"}),e.jsxs(E,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(U,{children:e.jsx(F,{})})}),e.jsxs(R,{children:[e.jsx(i,{value:"user",children:"Benutzer"}),e.jsx(i,{value:"reviewer",children:"Reviewer"}),e.jsx(i,{value:"admin",children:"Administrator"})]})]}),e.jsx(d,{})]})}),e.jsx(n,{control:r.control,name:"isActive",render:({field:s})=>e.jsxs(t,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{className:"text-base",children:"Aktiv"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Benutzer kann sich anmelden"})]}),e.jsx(c,{children:e.jsx(ee,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Abbrechen"}),e.jsx(o,{type:"submit",disabled:w.isPending,children:w.isPending?"Speichere...":"Speichern"})]})]})})]})})]})}export{$e as default};
